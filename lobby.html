<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>P2P Chat - Choose Room</title>
  <link rel="stylesheet" href="ui.css">
</head>
<body class="lobby-body">
  <button class="back-btn" onclick="goBack()">‚Üê</button>
  
  <div class="container lobby-container">
    <div class="header">
      <div class="lobby-logo">üí¨ P2P Chat</div>
      <div class="welcome">
        Welcome, <span class="user-name" id="userName"></span>! 
        Choose where you'd like to chat.
      </div>
    </div>

    <div class="room-options">
      <div class="room-card global-card" onclick="joinGlobal()">
        <span class="room-icon">üåç</span>
        <div class="room-title">Global Chat</div>
        <div class="room-description">
          Join the public chat room where everyone can connect and share messages.
        </div>
      </div>

      <div class="room-card private-card" onclick="showJoinModal()">
        <span class="room-icon">üîê</span>
        <div class="room-title">Join Private Room</div>
        <div class="room-description">
          Enter a room code to join a private conversation with specific people.
        </div>
      </div>

      <div class="room-card create-card" onclick="createRoom()">
        <span class="room-icon">‚ú®</span>
        <div class="room-title">Create Private Room</div>
        <div class="room-description">
          Generate a new private room and share the code with friends.
        </div>
      </div>
    </div>
  </div>

  <!-- Join Room Modal -->
  <div id="joinModal" class="modal">
    <div class="modal-content">
      <div class="modal-title">Join Private Room</div>
      <input 
        type="text" 
        id="roomCodeInput" 
        class="modal-input" 
        placeholder="Enter room code (e.g., ABC123)"
        maxlength="10"
        autocomplete="off"
      />
      <div class="modal-buttons">
        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="joinRoom()">Join Room</button>
      </div>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const localName = params.get('name') || '';
    
    if (!localName) {
      alert('No name provided.');
      window.location.href = 'index.html';
    }
    
    document.getElementById('userName').innerText = localName;

    function goToChat(room) {
      const url = `chatRoom.html?name=${encodeURIComponent(localName)}&room=${encodeURIComponent(room)}`;
      window.location.href = url;
    }

    function joinGlobal() {
      goToChat('global');
    }

    function showJoinModal() {
      document.getElementById('joinModal').style.display = 'block';
      document.getElementById('roomCodeInput').focus();
    }

    function closeModal() {
      document.getElementById('joinModal').style.display = 'none';
      document.getElementById('roomCodeInput').value = '';
    }

    function joinRoom() {
      const code = document.getElementById('roomCodeInput').value.trim().toUpperCase();
      if (code) {
        closeModal();
        goToChat(code);
      } else {
        document.getElementById('roomCodeInput').focus();
      }
    }

    function createRoom() {
      // Generate 6-character alphanumeric code
      const code = Math.random().toString(36).substr(2, 6).toUpperCase();
      goToChat(code);
    }

    function goBack() {
      window.location.href = 'index.html';
    }

    // Handle Enter key in modal
    document.getElementById('roomCodeInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        joinRoom();
      }
    });

    // Close modal when clicking outside
    document.getElementById('joinModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal();
      }
    });
  </script>
</body>
</html>
